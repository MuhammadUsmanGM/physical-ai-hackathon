"use strict";(globalThis.webpackChunkbook=globalThis.webpackChunkbook||[]).push([[5881],{8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var i=r(6540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},8995:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"The-Robotic-Nervous-System/ROS2-Communication-Patterns/ros2-communication-patterns","title":"ROS 2 Communication Patterns Deep Dive","description":"Introduction","source":"@site/docs/02-The-Robotic-Nervous-System/03-ROS2-Communication-Patterns/index.md","sourceDirName":"02-The-Robotic-Nervous-System/03-ROS2-Communication-Patterns","slug":"/module-02/ros2-communication-patterns","permalink":"/physical-ai-hackathon/docs/module-02/ros2-communication-patterns","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02-The-Robotic-Nervous-System/03-ROS2-Communication-Patterns/index.md","tags":[],"version":"current","frontMatter":{"id":"ros2-communication-patterns","title":"ROS 2 Communication Patterns Deep Dive","slug":"/module-02/ros2-communication-patterns"},"sidebar":"tutorialSidebar","previous":{"title":"Setting Up Your ROS 2 Development Environment","permalink":"/physical-ai-hackathon/docs/module-02/ros2-environment-setup"},"next":{"title":"URDF for Humanoid Robots","permalink":"/physical-ai-hackathon/docs/module-02/urdf-for-humanoids"}}');var s=r(4848),t=r(8453);const o={id:"ros2-communication-patterns",title:"ROS 2 Communication Patterns Deep Dive",slug:"/module-02/ros2-communication-patterns"},l="ROS 2 Communication Patterns Deep Dive",a={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Pattern 1: Topics (Publish-Subscribe)",id:"pattern-1-topics-publish-subscribe",level:2},{value:"When to Use Topics",id:"when-to-use-topics",level:3},{value:"How Topics Work",id:"how-topics-work",level:3},{value:"Complete Publisher Example",id:"complete-publisher-example",level:3},{value:"Complete Subscriber Example",id:"complete-subscriber-example",level:3},{value:"Running the Publisher-Subscriber Example",id:"running-the-publisher-subscriber-example",level:3},{value:"Pattern 2: Services (Request-Response)",id:"pattern-2-services-request-response",level:2},{value:"When to Use Services",id:"when-to-use-services",level:3},{value:"How Services Work",id:"how-services-work",level:3},{value:"Service Definition Example",id:"service-definition-example",level:3},{value:"Complete Service Server Example",id:"complete-service-server-example",level:3},{value:"Complete Service Client Example",id:"complete-service-client-example",level:3},{value:"Running the Service Example",id:"running-the-service-example",level:3},{value:"Pattern 3: Actions (Long-Running Tasks)",id:"pattern-3-actions-long-running-tasks",level:2},{value:"When to Use Actions",id:"when-to-use-actions",level:3},{value:"How Actions Work",id:"how-actions-work",level:3},{value:"Action Definition Example",id:"action-definition-example",level:3},{value:"Complete Action Server Example",id:"complete-action-server-example",level:3},{value:"Complete Action Client Example",id:"complete-action-client-example",level:3},{value:"Running the Action Example",id:"running-the-action-example",level:3},{value:"Choosing the Right Communication Pattern",id:"choosing-the-right-communication-pattern",level:2},{value:"Quality of Service (QoS) Policies",id:"quality-of-service-qos-policies",level:2},{value:"Common QoS Profiles",id:"common-qos-profiles",level:3},{value:"QoS Policy Comparison",id:"qos-policy-comparison",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Topic Best Practices",id:"topic-best-practices",level:3},{value:"Service Best Practices",id:"service-best-practices",level:3},{value:"Action Best Practices",id:"action-best-practices",level:3},{value:"Hands-On Exercise",id:"hands-on-exercise",level:2},{value:"Summary",id:"summary",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"ros-2-communication-patterns-deep-dive",children:"ROS 2 Communication Patterns Deep Dive"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsxs)(n.p,{children:["ROS 2 provides three primary communication patterns that enable different types of interactions between nodes: ",(0,s.jsx)(n.strong,{children:"Topics"})," (publish-subscribe), ",(0,s.jsx)(n.strong,{children:"Services"})," (request-response), and ",(0,s.jsx)(n.strong,{children:"Actions"})," (long-running tasks with feedback). Understanding when and how to use each pattern is crucial for building robust robotic systems."]}),"\n",(0,s.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:'graph TB\r\n    subgraph "ROS 2 Communication Patterns"\r\n        subgraph "Topics (Pub/Sub)"\r\n            P1[Publisher Node] --\x3e|Continuous Data| T[Topic]\r\n            T --\x3e|Subscribe| S1[Subscriber 1]\r\n            T --\x3e|Subscribe| S2[Subscriber 2]\r\n        end\r\n        \r\n        subgraph "Services (Req/Res)"\r\n            C[Client Node] --\x3e|Request| SRV[Service Server]\r\n            SRV --\x3e|Response| C\r\n        end\r\n        \r\n        subgraph "Actions (Long Tasks)"\r\n            AC[Action Client] --\x3e|Goal| AS[Action Server]\r\n            AS --\x3e|Feedback| AC\r\n            AS --\x3e|Result| AC\r\n            AC --\x3e|Cancel| AS\r\n        end\r\n    end\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"pattern-1-topics-publish-subscribe",children:"Pattern 1: Topics (Publish-Subscribe)"}),"\n",(0,s.jsx)(n.h3,{id:"when-to-use-topics",children:"When to Use Topics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Continuous data streams"}),": Sensor data, robot state, camera feeds"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"One-to-many communication"}),": Multiple nodes need the same data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Asynchronous communication"}),": Publisher doesn't wait for subscribers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"High-frequency updates"}),": Real-time sensor data (10-100+ Hz)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"how-topics-work",children:"How Topics Work"}),"\n",(0,s.jsxs)(n.p,{children:["Topics implement a ",(0,s.jsx)(n.strong,{children:"many-to-many"})," communication pattern where:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Publishers send messages to a named topic"}),"\n",(0,s.jsx)(n.li,{children:"Subscribers receive all messages from topics they subscribe to"}),"\n",(0,s.jsx)(n.li,{children:"No direct connection between publishers and subscribers"}),"\n",(0,s.jsx)(n.li,{children:"Messages are fire-and-forget (no acknowledgment)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"complete-publisher-example",children:"Complete Publisher Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nROS 2 Publisher Example: Publishing robot sensor data\r\n"""\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import Imu\r\nfrom geometry_msgs.msg import Vector3\r\nimport math\r\nimport time\r\n\r\nclass ImuPublisher(Node):\r\n    """\r\n    Publishes simulated IMU data for a humanoid robot.\r\n    Demonstrates proper ROS 2 publisher implementation.\r\n    """\r\n    \r\n    def __init__(self):\r\n        super().__init__(\'imu_publisher\')\r\n        \r\n        # Create publisher for IMU data\r\n        self.publisher_ = self.create_publisher(\r\n            Imu,                    # Message type\r\n            \'humanoid/imu/data\',    # Topic name\r\n            10                      # Queue size (QoS depth)\r\n        )\r\n        \r\n        # Create timer for periodic publishing (100 Hz)\r\n        self.timer_period = 0.01  # 10ms = 100Hz\r\n        self.timer = self.create_timer(self.timer_period, self.timer_callback)\r\n        \r\n        # Initialize simulation variables\r\n        self.counter = 0\r\n        self.get_logger().info(\'IMU Publisher started - Publishing at 100 Hz\')\r\n    \r\n    def timer_callback(self):\r\n        """Called periodically to publish IMU data"""\r\n        msg = Imu()\r\n        \r\n        # Set header information\r\n        msg.header.stamp = self.get_clock().now().to_msg()\r\n        msg.header.frame_id = \'imu_link\'\r\n        \r\n        # Simulate angular velocity (gyroscope data)\r\n        # Small oscillation to simulate natural robot movement\r\n        msg.angular_velocity.x = 0.01 * math.sin(self.counter * 0.1)\r\n        msg.angular_velocity.y = 0.01 * math.cos(self.counter * 0.1)\r\n        msg.angular_velocity.z = 0.005 * math.sin(self.counter * 0.05)\r\n        \r\n        # Simulate linear acceleration (accelerometer data)\r\n        # Gravity + small noise\r\n        msg.linear_acceleration.x = 0.1 * math.sin(self.counter * 0.2)\r\n        msg.linear_acceleration.y = 0.1 * math.cos(self.counter * 0.2)\r\n        msg.linear_acceleration.z = 9.81  # Gravity\r\n        \r\n        # Publish the message\r\n        self.publisher_.publish(msg)\r\n        \r\n        # Log every 100 messages (once per second at 100Hz)\r\n        if self.counter % 100 == 0:\r\n            self.get_logger().info(f\'Publishing IMU data: counter={self.counter}\')\r\n        \r\n        self.counter += 1\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    imu_publisher = ImuPublisher()\r\n    \r\n    try:\r\n        rclpy.spin(imu_publisher)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        imu_publisher.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"complete-subscriber-example",children:"Complete Subscriber Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nROS 2 Subscriber Example: Processing robot sensor data\r\n\"\"\"\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import Imu\r\nimport math\r\n\r\nclass ImuSubscriber(Node):\r\n    \"\"\"\r\n    Subscribes to IMU data and processes it for robot state estimation.\r\n    Demonstrates proper ROS 2 subscriber implementation.\r\n    \"\"\"\r\n    \r\n    def __init__(self):\r\n        super().__init__('imu_subscriber')\r\n        \r\n        # Create subscription to IMU topic\r\n        self.subscription = self.create_subscription(\r\n            Imu,                        # Message type\r\n            'humanoid/imu/data',        # Topic name (must match publisher)\r\n            self.imu_callback,          # Callback function\r\n            10                          # Queue size (QoS depth)\r\n        )\r\n        \r\n        # Prevent unused variable warning\r\n        self.subscription\r\n        \r\n        # Initialize state variables\r\n        self.message_count = 0\r\n        self.max_angular_velocity = 0.0\r\n        \r\n        self.get_logger().info('IMU Subscriber started - Waiting for data...')\r\n    \r\n    def imu_callback(self, msg):\r\n        \"\"\"\r\n        Callback function executed when a message is received.\r\n        \r\n        Args:\r\n            msg (Imu): The received IMU message\r\n        \"\"\"\r\n        self.message_count += 1\r\n        \r\n        # Calculate magnitude of angular velocity\r\n        angular_vel_magnitude = math.sqrt(\r\n            msg.angular_velocity.x**2 + \r\n            msg.angular_velocity.y**2 + \r\n            msg.angular_velocity.z**2\r\n        )\r\n        \r\n        # Track maximum angular velocity\r\n        if angular_vel_magnitude > self.max_angular_velocity:\r\n            self.max_angular_velocity = angular_vel_magnitude\r\n        \r\n        # Calculate magnitude of linear acceleration\r\n        linear_accel_magnitude = math.sqrt(\r\n            msg.linear_acceleration.x**2 + \r\n            msg.linear_acceleration.y**2 + \r\n            msg.linear_acceleration.z**2\r\n        )\r\n        \r\n        # Log every 100 messages (once per second at 100Hz)\r\n        if self.message_count % 100 == 0:\r\n            self.get_logger().info(\r\n                f'Received {self.message_count} messages | '\r\n                f'Angular vel: {angular_vel_magnitude:.4f} rad/s | '\r\n                f'Linear accel: {linear_accel_magnitude:.2f} m/s\xb2 | '\r\n                f'Max angular vel: {self.max_angular_velocity:.4f} rad/s'\r\n            )\r\n        \r\n        # Example: Detect if robot is falling (high angular velocity)\r\n        if angular_vel_magnitude > 0.5:\r\n            self.get_logger().warn(\r\n                f'High angular velocity detected: {angular_vel_magnitude:.4f} rad/s - '\r\n                'Robot may be unstable!'\r\n            )\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    imu_subscriber = ImuSubscriber()\r\n    \r\n    try:\r\n        rclpy.spin(imu_subscriber)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        imu_subscriber.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"running-the-publisher-subscriber-example",children:"Running the Publisher-Subscriber Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Start the publisher\r\nros2 run my_robot_package imu_publisher\r\n\r\n# Terminal 2: Start the subscriber\r\nros2 run my_robot_package imu_subscriber\r\n\r\n# Terminal 3: Inspect the topic\r\nros2 topic list\r\nros2 topic info /humanoid/imu/data\r\nros2 topic echo /humanoid/imu/data --once\r\nros2 topic hz /humanoid/imu/data\r\n\r\n# Visualize the node graph\r\nrqt_graph\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Expected Output:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"[INFO] [imu_publisher]: IMU Publisher started - Publishing at 100 Hz\r\n[INFO] [imu_publisher]: Publishing IMU data: counter=0\r\n[INFO] [imu_subscriber]: IMU Subscriber started - Waiting for data...\r\n[INFO] [imu_subscriber]: Received 100 messages | Angular vel: 0.0141 rad/s | Linear accel: 9.82 m/s\xb2\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"pattern-2-services-request-response",children:"Pattern 2: Services (Request-Response)"}),"\n",(0,s.jsx)(n.h3,{id:"when-to-use-services",children:"When to Use Services"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Synchronous operations"}),": Client waits for response"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"One-time requests"}),": Configuration, calculations, state queries"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Guaranteed response"}),": Need confirmation of completion"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Low-frequency operations"}),": Not real-time critical"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"how-services-work",children:"How Services Work"}),"\n",(0,s.jsxs)(n.p,{children:["Services implement a ",(0,s.jsx)(n.strong,{children:"client-server"})," pattern where:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Client sends a request and blocks until receiving a response"}),"\n",(0,s.jsx)(n.li,{children:"Server processes the request and sends back a result"}),"\n",(0,s.jsx)(n.li,{children:"One-to-one communication (one client per request)"}),"\n",(0,s.jsx)(n.li,{children:"Suitable for infrequent operations"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"service-definition-example",children:"Service Definition Example"}),"\n",(0,s.jsxs)(n.p,{children:["First, define a custom service type in ",(0,s.jsx)(n.code,{children:"srv/SetRobotMode.srv"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'# Request\r\nstring mode  # "walk", "stand", "sit", "idle"\r\n---\r\n# Response\r\nbool success\r\nstring message\n'})}),"\n",(0,s.jsx)(n.h3,{id:"complete-service-server-example",children:"Complete Service Server Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nROS 2 Service Server Example: Robot mode control\r\n"""\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import SetBool  # Using standard service for simplicity\r\n# In practice, you\'d use: from my_robot_interfaces.srv import SetRobotMode\r\n\r\nclass RobotModeServer(Node):\r\n    """\r\n    Service server that controls the humanoid robot\'s operational mode.\r\n    Demonstrates proper ROS 2 service server implementation.\r\n    """\r\n    \r\n    def __init__(self):\r\n        super().__init__(\'robot_mode_server\')\r\n        \r\n        # Create service server\r\n        self.srv = self.create_service(\r\n            SetBool,                    # Service type\r\n            \'set_robot_mode\',           # Service name\r\n            self.set_mode_callback      # Callback function\r\n        )\r\n        \r\n        # Initialize robot state\r\n        self.current_mode = "idle"\r\n        self.valid_modes = ["walk", "stand", "sit", "idle"]\r\n        \r\n        self.get_logger().info(\'Robot Mode Service Server started\')\r\n        self.get_logger().info(f\'Current mode: {self.current_mode}\')\r\n    \r\n    def set_mode_callback(self, request, response):\r\n        """\r\n        Callback function for service requests.\r\n        \r\n        Args:\r\n            request: Service request (SetBool.Request)\r\n            response: Service response (SetBool.Response)\r\n            \r\n        Returns:\r\n            response: Filled response object\r\n        """\r\n        # For this example, True = walk mode, False = idle mode\r\n        requested_mode = "walk" if request.data else "idle"\r\n        \r\n        self.get_logger().info(f\'Received request to set mode: {requested_mode}\')\r\n        \r\n        # Validate the requested mode\r\n        if requested_mode in self.valid_modes:\r\n            # Simulate mode transition (in real robot, this would control actuators)\r\n            old_mode = self.current_mode\r\n            self.current_mode = requested_mode\r\n            \r\n            response.success = True\r\n            response.message = f\'Successfully changed mode from {old_mode} to {requested_mode}\'\r\n            \r\n            self.get_logger().info(response.message)\r\n        else:\r\n            response.success = False\r\n            response.message = f\'Invalid mode: {requested_mode}. Valid modes: {self.valid_modes}\'\r\n            \r\n            self.get_logger().error(response.message)\r\n        \r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    robot_mode_server = RobotModeServer()\r\n    \r\n    try:\r\n        rclpy.spin(robot_mode_server)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        robot_mode_server.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"complete-service-client-example",children:"Complete Service Client Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nROS 2 Service Client Example: Requesting robot mode changes\r\n\"\"\"\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import SetBool\r\nimport sys\r\n\r\nclass RobotModeClient(Node):\r\n    \"\"\"\r\n    Service client that requests robot mode changes.\r\n    Demonstrates proper ROS 2 service client implementation.\r\n    \"\"\"\r\n    \r\n    def __init__(self):\r\n        super().__init__('robot_mode_client')\r\n        \r\n        # Create service client\r\n        self.client = self.create_client(SetBool, 'set_robot_mode')\r\n        \r\n        # Wait for service to be available\r\n        while not self.client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Waiting for service to become available...')\r\n        \r\n        self.get_logger().info('Service client ready')\r\n    \r\n    def send_request(self, enable_walk):\r\n        \"\"\"\r\n        Send a service request to change robot mode.\r\n        \r\n        Args:\r\n            enable_walk (bool): True for walk mode, False for idle mode\r\n        \"\"\"\r\n        request = SetBool.Request()\r\n        request.data = enable_walk\r\n        \r\n        mode_name = \"walk\" if enable_walk else \"idle\"\r\n        self.get_logger().info(f'Sending request to set mode: {mode_name}')\r\n        \r\n        # Call service asynchronously\r\n        future = self.client.call_async(request)\r\n        \r\n        # Wait for response\r\n        rclpy.spin_until_future_complete(self, future)\r\n        \r\n        if future.result() is not None:\r\n            response = future.result()\r\n            if response.success:\r\n                self.get_logger().info(f'\u2713 {response.message}')\r\n            else:\r\n                self.get_logger().error(f'\u2717 {response.message}')\r\n        else:\r\n            self.get_logger().error('Service call failed')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    \r\n    # Parse command line argument\r\n    if len(sys.argv) < 2:\r\n        print('Usage: robot_mode_client <walk|idle>')\r\n        return\r\n    \r\n    mode = sys.argv[1].lower()\r\n    enable_walk = (mode == 'walk')\r\n    \r\n    robot_mode_client = RobotModeClient()\r\n    robot_mode_client.send_request(enable_walk)\r\n    \r\n    robot_mode_client.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"running-the-service-example",children:"Running the Service Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Terminal 1: Start the service server\r\nros2 run my_robot_package robot_mode_server\r\n\r\n# Terminal 2: Call the service from command line\r\nros2 service list\r\nros2 service type /set_robot_mode\r\nros2 service call /set_robot_mode example_interfaces/srv/SetBool "{data: true}"\r\n\r\n# Terminal 3: Use the client node\r\nros2 run my_robot_package robot_mode_client walk\r\nros2 run my_robot_package robot_mode_client idle\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"pattern-3-actions-long-running-tasks",children:"Pattern 3: Actions (Long-Running Tasks)"}),"\n",(0,s.jsx)(n.h3,{id:"when-to-use-actions",children:"When to Use Actions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Long-running tasks"}),": Navigation, manipulation, complex behaviors"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Need feedback"}),": Progress updates during execution"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cancellable operations"}),": Ability to abort mid-execution"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Goal-oriented tasks"}),": Clear start, progress, and completion"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"how-actions-work",children:"How Actions Work"}),"\n",(0,s.jsxs)(n.p,{children:["Actions implement a ",(0,s.jsx)(n.strong,{children:"goal-oriented"})," pattern where:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Client sends a goal to the action server"}),"\n",(0,s.jsx)(n.li,{children:"Server provides periodic feedback on progress"}),"\n",(0,s.jsx)(n.li,{children:"Server sends a final result when complete"}),"\n",(0,s.jsx)(n.li,{children:"Client can cancel the goal at any time"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"action-definition-example",children:"Action Definition Example"}),"\n",(0,s.jsxs)(n.p,{children:["Define a custom action in ",(0,s.jsx)(n.code,{children:"action/NavigateToPoint.action"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"# Goal\r\nfloat64 target_x\r\nfloat64 target_y\r\nfloat64 target_theta\r\n---\r\n# Result\r\nbool success\r\nfloat64 final_x\r\nfloat64 final_y\r\nstring message\r\n---\r\n# Feedback\r\nfloat64 current_x\r\nfloat64 current_y\r\nfloat64 distance_remaining\r\nfloat64 estimated_time_remaining\n"})}),"\n",(0,s.jsx)(n.h3,{id:"complete-action-server-example",children:"Complete Action Server Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nROS 2 Action Server Example: Humanoid navigation\r\n"""\r\nimport rclpy\r\nfrom rclpy.action import ActionServer\r\nfrom rclpy.node import Node\r\nfrom action_tutorials_interfaces.action import Fibonacci  # Using standard action for example\r\nimport time\r\nimport math\r\n\r\nclass NavigationActionServer(Node):\r\n    """\r\n    Action server for humanoid robot navigation.\r\n    Demonstrates proper ROS 2 action server implementation.\r\n    """\r\n    \r\n    def __init__(self):\r\n        super().__init__(\'navigation_action_server\')\r\n        \r\n        # Create action server\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,                      # Action type\r\n            \'navigate_to_point\',            # Action name\r\n            self.execute_callback           # Execution callback\r\n        )\r\n        \r\n        self.get_logger().info(\'Navigation Action Server started\')\r\n    \r\n    def execute_callback(self, goal_handle):\r\n        """\r\n        Execute the navigation goal.\r\n        \r\n        Args:\r\n            goal_handle: Handle to the goal being executed\r\n            \r\n        Returns:\r\n            result: The final result of the action\r\n        """\r\n        self.get_logger().info(\'Executing navigation goal...\')\r\n        \r\n        # Get the goal (in this example, Fibonacci sequence length)\r\n        # In real navigation, this would be target coordinates\r\n        order = goal_handle.request.order\r\n        \r\n        # Initialize feedback message\r\n        feedback_msg = Fibonacci.Feedback()\r\n        feedback_msg.sequence = [0, 1]\r\n        \r\n        # Simulate navigation with feedback\r\n        for i in range(1, order):\r\n            # Check if goal was cancelled\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info(\'Goal cancelled\')\r\n                result = Fibonacci.Result()\r\n                result.sequence = feedback_msg.sequence\r\n                return result\r\n            \r\n            # Update progress (simulate navigation steps)\r\n            feedback_msg.sequence.append(\r\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1]\r\n            )\r\n            \r\n            # Publish feedback\r\n            goal_handle.publish_feedback(feedback_msg)\r\n            \r\n            # Log progress\r\n            progress = (i / order) * 100\r\n            self.get_logger().info(f\'Navigation progress: {progress:.1f}%\')\r\n            \r\n            # Simulate time taken for each step\r\n            time.sleep(0.5)\r\n        \r\n        # Mark goal as succeeded\r\n        goal_handle.succeed()\r\n        \r\n        # Return final result\r\n        result = Fibonacci.Result()\r\n        result.sequence = feedback_msg.sequence\r\n        \r\n        self.get_logger().info(\'Navigation completed successfully!\')\r\n        return result\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    navigation_action_server = NavigationActionServer()\r\n    \r\n    try:\r\n        rclpy.spin(navigation_action_server)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        navigation_action_server.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"complete-action-client-example",children:"Complete Action Client Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nROS 2 Action Client Example: Sending navigation goals\r\n"""\r\nimport rclpy\r\nfrom rclpy.action import ActionClient\r\nfrom rclpy.node import Node\r\nfrom action_tutorials_interfaces.action import Fibonacci\r\n\r\nclass NavigationActionClient(Node):\r\n    """\r\n    Action client for sending navigation goals to humanoid robot.\r\n    Demonstrates proper ROS 2 action client implementation.\r\n    """\r\n    \r\n    def __init__(self):\r\n        super().__init__(\'navigation_action_client\')\r\n        \r\n        # Create action client\r\n        self._action_client = ActionClient(\r\n            self,\r\n            Fibonacci,\r\n            \'navigate_to_point\'\r\n        )\r\n        \r\n        self.get_logger().info(\'Navigation Action Client started\')\r\n    \r\n    def send_goal(self, target_order):\r\n        """\r\n        Send a navigation goal to the action server.\r\n        \r\n        Args:\r\n            target_order: The goal parameter (Fibonacci order in this example)\r\n        """\r\n        # Wait for action server\r\n        self.get_logger().info(\'Waiting for action server...\')\r\n        self._action_client.wait_for_server()\r\n        \r\n        # Create goal message\r\n        goal_msg = Fibonacci.Goal()\r\n        goal_msg.order = target_order\r\n        \r\n        self.get_logger().info(f\'Sending navigation goal: order={target_order}\')\r\n        \r\n        # Send goal with callbacks\r\n        self._send_goal_future = self._action_client.send_goal_async(\r\n            goal_msg,\r\n            feedback_callback=self.feedback_callback\r\n        )\r\n        \r\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\r\n    \r\n    def goal_response_callback(self, future):\r\n        """Called when server accepts or rejects the goal"""\r\n        goal_handle = future.result()\r\n        \r\n        if not goal_handle.accepted:\r\n            self.get_logger().error(\'Goal rejected by server\')\r\n            return\r\n        \r\n        self.get_logger().info(\'Goal accepted by server\')\r\n        \r\n        # Get result\r\n        self._get_result_future = goal_handle.get_result_async()\r\n        self._get_result_future.add_done_callback(self.get_result_callback)\r\n    \r\n    def feedback_callback(self, feedback_msg):\r\n        """Called when server sends feedback"""\r\n        feedback = feedback_msg.feedback\r\n        self.get_logger().info(f\'Received feedback: {feedback.sequence}\')\r\n    \r\n    def get_result_callback(self, future):\r\n        """Called when action is complete"""\r\n        result = future.result().result\r\n        self.get_logger().info(f\'Navigation complete! Result: {result.sequence}\')\r\n        \r\n        # Shutdown after receiving result\r\n        rclpy.shutdown()\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    \r\n    action_client = NavigationActionClient()\r\n    action_client.send_goal(10)  # Navigate with order=10\r\n    \r\n    try:\r\n        rclpy.spin(action_client)\r\n    except KeyboardInterrupt:\r\n        pass\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"running-the-action-example",children:"Running the Action Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Terminal 1: Start the action server\r\nros2 run my_robot_package navigation_action_server\r\n\r\n# Terminal 2: Send a goal using the client\r\nros2 run my_robot_package navigation_action_client\r\n\r\n# Terminal 3: Inspect the action\r\nros2 action list\r\nros2 action info /navigate_to_point\r\nros2 action send_goal /navigate_to_point action_tutorials_interfaces/action/Fibonacci "{order: 5}"\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"choosing-the-right-communication-pattern",children:"Choosing the Right Communication Pattern"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Use Case"}),(0,s.jsx)(n.th,{children:"Pattern"}),(0,s.jsx)(n.th,{children:"Reason"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Sensor data streaming"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Topic"})}),(0,s.jsx)(n.td,{children:"Continuous, high-frequency, one-to-many"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Camera images"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Topic"})}),(0,s.jsx)(n.td,{children:"Continuous stream, multiple consumers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Robot state"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Topic"})}),(0,s.jsx)(n.td,{children:"Continuous updates, many subscribers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Get current configuration"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Service"})}),(0,s.jsx)(n.td,{children:"One-time request, need response"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Set parameter"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Service"})}),(0,s.jsx)(n.td,{children:"Synchronous operation, confirmation needed"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Navigate to waypoint"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Action"})}),(0,s.jsx)(n.td,{children:"Long-running, need feedback, cancellable"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pick and place object"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Action"})}),(0,s.jsx)(n.td,{children:"Multi-step task, progress monitoring"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Emergency stop"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Service"})}),(0,s.jsx)(n.td,{children:"Immediate, synchronous, critical"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"quality-of-service-qos-policies",children:"Quality of Service (QoS) Policies"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 allows fine-grained control over message delivery through QoS policies:"}),"\n",(0,s.jsx)(n.h3,{id:"common-qos-profiles",children:"Common QoS Profiles"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy, DurabilityPolicy\r\n\r\n# Sensor data (best effort, latest only)\r\nsensor_qos = QoSProfile(\r\n    reliability=ReliabilityPolicy.BEST_EFFORT,\r\n    history=HistoryPolicy.KEEP_LAST,\r\n    depth=1\r\n)\r\n\r\n# Critical commands (reliable, keep all)\r\ncommand_qos = QoSProfile(\r\n    reliability=ReliabilityPolicy.RELIABLE,\r\n    history=HistoryPolicy.KEEP_ALL,\r\n    depth=10\r\n)\r\n\r\n# Use in publisher\r\nself.publisher_ = self.create_publisher(\r\n    Imu,\r\n    'humanoid/imu/data',\r\n    sensor_qos  # Apply QoS profile\r\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"qos-policy-comparison",children:"QoS Policy Comparison"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Policy"}),(0,s.jsx)(n.th,{children:"Options"}),(0,s.jsx)(n.th,{children:"Use Case"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Reliability"})}),(0,s.jsx)(n.td,{children:"BEST_EFFORT, RELIABLE"}),(0,s.jsx)(n.td,{children:"Sensor data vs. Commands"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Durability"})}),(0,s.jsx)(n.td,{children:"VOLATILE, TRANSIENT_LOCAL"}),(0,s.jsx)(n.td,{children:"Real-time vs. Late joiners"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"History"})}),(0,s.jsx)(n.td,{children:"KEEP_LAST, KEEP_ALL"}),(0,s.jsx)(n.td,{children:"Latest only vs. All messages"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Depth"})}),(0,s.jsx)(n.td,{children:"1, 10, 100, etc."}),(0,s.jsx)(n.td,{children:"Queue size for buffering"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"topic-best-practices",children:"Topic Best Practices"}),"\n",(0,s.jsxs)(n.p,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"DO:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Use descriptive topic names: ",(0,s.jsx)(n.code,{children:"/robot_name/sensor_type/data"})]}),"\n",(0,s.jsx)(n.li,{children:"Publish at consistent rates"}),"\n",(0,s.jsx)(n.li,{children:"Use appropriate QoS policies"}),"\n",(0,s.jsx)(n.li,{children:"Keep messages small and focused"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u274c ",(0,s.jsx)(n.strong,{children:"DON'T:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Publish at irregular intervals"}),"\n",(0,s.jsxs)(n.li,{children:["Use generic names like ",(0,s.jsx)(n.code,{children:"/data"})]}),"\n",(0,s.jsx)(n.li,{children:"Send large messages at high rates"}),"\n",(0,s.jsx)(n.li,{children:"Mix unrelated data in one message"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"service-best-practices",children:"Service Best Practices"}),"\n",(0,s.jsxs)(n.p,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"DO:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use for infrequent operations"}),"\n",(0,s.jsx)(n.li,{children:"Implement timeout handling"}),"\n",(0,s.jsx)(n.li,{children:"Validate request parameters"}),"\n",(0,s.jsx)(n.li,{children:"Provide meaningful response messages"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u274c ",(0,s.jsx)(n.strong,{children:"DON'T:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use for high-frequency operations"}),"\n",(0,s.jsx)(n.li,{children:"Block indefinitely waiting for response"}),"\n",(0,s.jsx)(n.li,{children:"Use for streaming data"}),"\n",(0,s.jsx)(n.li,{children:"Ignore error conditions"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"action-best-practices",children:"Action Best Practices"}),"\n",(0,s.jsxs)(n.p,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"DO:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Provide regular feedback updates"}),"\n",(0,s.jsx)(n.li,{children:"Implement cancellation handling"}),"\n",(0,s.jsx)(n.li,{children:"Set realistic goals"}),"\n",(0,s.jsx)(n.li,{children:"Report meaningful progress"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u274c ",(0,s.jsx)(n.strong,{children:"DON'T:"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use for simple operations"}),"\n",(0,s.jsx)(n.li,{children:"Ignore cancel requests"}),"\n",(0,s.jsx)(n.li,{children:"Provide misleading feedback"}),"\n",(0,s.jsx)(n.li,{children:"Block without updates"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"hands-on-exercise",children:"Hands-On Exercise"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Challenge:"})," Create a complete humanoid robot control system using all three patterns:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Topic"}),": Publish joint states at 50 Hz"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Service"}),': Implement a "calibrate sensors" service']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Action"}),': Create a "walk forward" action with distance feedback']}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution template provided in the labs directory."})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Topics"}),": Continuous data streams, asynchronous, many-to-many"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Services"}),": One-time requests, synchronous, one-to-one"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Actions"}),": Long-running tasks, feedback, cancellable"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Understanding these patterns is fundamental to building effective ROS 2 robotic systems. In the next chapter, we'll explore how to define robot structures using URDF for humanoid robots."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts.html",children:"ROS 2 Concepts Documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html",children:"ROS 2 QoS Policies"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://design.ros2.org/articles/actions.html",children:"Action Design Best Practices"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);